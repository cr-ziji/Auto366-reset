<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Auto366</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <button id="update-notification-btn" class="update-notification-btn" title="发现新版本">
        <svg class="update-notification-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
                fill="currentColor" />
        </svg>
        <span class="update-notification-text">发现新版本</span>
    </button>
    <button class="settings-btn"><img src="setting.svg" alt="设置" class="settings-icon"> 设置</button>

    <div class="container">
        <div id="universal-answer-content" class="content-area">
            <h1>万能答案获取</h1>

            <div class="tutorial">
                <h2>使用教程</h2>
                <ol>
                    <li><strong>启动代理服务器：</strong>点击"启动代理服务器"按钮（代理启动后会自动开始监听）</li>
                    <li><strong>设置客户端代理：</strong>在天学网客户端设置HTTP代理为 127.0.0.1:5291</li>
                    <li><strong>下载题目：</strong>在天学网客户端下载需要的题目</li>
                    <li><strong>自动处理：</strong>程序会自动检测、下载、解压并提取答案</li>
                    <li><strong>查看答案：</strong>答案会显示在下方区域，并自动保存到文件</li>
                </ol>
                <div class="proxy-notice">
                    <strong>⚠️ 重要提示：</strong>
                    <ul>
                        <li>必须设置为 <strong>HTTP代理</strong>，不是SOCKS5代理</li>
                        <li>代理地址：127.0.0.1，端口：5291</li>
                        <li>确保端口5291没有被其他程序占用</li>
                    </ul>
                </div>
            </div>

            <div class="proxy-controls">
                <div class="buttons">
                    <button id="startProxyBtn">启动代理服务器</button>
                    <button id="stopProxyBtn" disabled>停止代理服务器</button>
                    <button id="responseRulesBtn">更改响应体规则</button>
                    <button id="deleteTempBtn" class="delete-btn">删除缓存</button>
                </div>

                <div class="status-indicators">
                    <div class="status-item">
                        <span class="status-label">代理状态：</span>
                        <span id="proxyStatus" class="status-value">未启动</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">证书状态：</span>
                        <span id="certificateStatus" class="status-value">未检查</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">处理状态：</span>
                        <span id="processStatus" class="status-value">等待中</span>
                    </div>
                </div>
            </div>

            <div class="traffic-monitor">
                <h3>监听日志</h3>
                <div id="trafficLog" class="traffic-log">
                    <div class="log-item">等待网络请求...</div>
                </div>
            </div>

            <div class="answers-display">
                <div class="answers-header">
                    <h3>此次结果</h3>
                    <div class="clear-answers-button">
                        <button id="clearAnswersBtn" class="clear-btn" title="清空提取结果">
                            <svg t="1756262061386" class="clear-icon" viewBox="0 0 1024 1024" version="1.1"
                                xmlns="http://www.w3.org/2000/svg" p-id="4752" width="256" height="256">
                                <path
                                    d="M829.952 271.36h-126.976v-51.2a76.288 76.288 0 0 0-75.776-76.288h-256a76.288 76.288 0 0 0-75.776 76.8v51.2H168.448a25.6 25.6 0 0 0 0 51.2h661.504a25.6 25.6 0 0 0 0-51.712z m-178.176 0h-307.2v-51.2a26.112 26.112 0 0 1 25.6-25.6h256a24.576 24.576 0 0 1 24.576 25.6zM448.512 677.376V398.336a25.6 25.6 0 0 0-51.2 0v279.04a25.6 25.6 0 0 0 51.2 0zM601.088 677.376V398.336a25.6 25.6 0 0 0-51.2 0v279.04a25.6 25.6 0 0 0 51.2 0z"
                                    fill="" p-id="4753"></path>
                                <path
                                    d="M735.744 346.624a25.6 25.6 0 0 0-25.6 25.6v381.44a102.4 102.4 0 0 1-102.4 102.4H390.656a102.4 102.4 0 0 1-102.4-102.4V372.224a25.6 25.6 0 0 0-51.2 0v381.44a153.6 153.6 0 0 0 153.6 153.6h217.6a153.6 153.6 0 0 0 153.6-153.6V372.224a25.6 25.6 0 0 0-26.112-25.6z"
                                    fill="" p-id="4754"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="sort-mode-selector">
                        <label for="sortMode">排序模式：</label>
                        <select id="sortMode">
                            <option value="file">按文件排序</option>
                            <option value="pattern">按题型排序</option>
                        </select>
                    </div>
                    <div class="import-answer-button">
                        <label for="importAnswer" id="importAnswerBtn">导入答案</label>
                        <input type="file" accept="json" id="importAnswer">
                    </div>
                    <div class="share-answer-button">
                        <button id="shareAnswerBtn" class="share-btn" title="分享答案">分享答案</button>
                    </div>
                </div>
                <div id="answersContainer" class="answers-container">
                    <div class="no-answers">暂无答案数据</div>
                </div>
            </div>

            <div
                style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee; text-align: center; color: #666; font-size: 12px;">
                <p><strong>免责声明</strong>：本工具仅供学习和研究使用并且<strong>完全免费提供</strong>，使用者需自行承担使用风险，开发者不承担任何法律责任。</p>
                <p>项目地址：<a href="https://github.com/cyrilguocode/Auto366" target="_blank"
                        style="color: #007bff;">https://github.com/cyrilguocode/Auto366</a></p>
                <p>许可证：GNU General Public License v3.0</p>
            </div>
        </div>
    </div>

    <!-- 响应体更改规则弹窗 -->
    <div id="response-rules-modal" class="modal">
        <div class="modal-content response-rules-modal">
            <div class="modal-header">
                <h2>响应体更改规则</h2>
                <span class="close" id="close-response-rules">&times;</span>
            </div>
            <div class="rules-container">
                <div class="rules-toolbar">
                    <button id="add-rule-btn" class="add-rule-btn">新建规则</button>
                    <button id="import-rules-btn" class="import-btn">导入规则</button>
                    <button id="export-rules-btn" class="export-btn">导出规则</button>
                    <div class="rules-status">
                        <span id="rules-count">规则数量: 0</span>
                        <span id="active-rules-count">启用: 0</span>
                    </div>
                </div>
                <div class="rules-list" id="rules-list">
                    <div class="no-rules">暂无规则，点击"新建规则"开始添加</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 规则编辑弹窗 -->
    <div id="rule-edit-modal" class="modal">
        <div class="modal-content rule-edit-modal">
            <div class="modal-header">
                <h2 id="rule-edit-title">新建规则</h2>
                <span class="close" id="close-rule-edit">&times;</span>
            </div>
            <div class="rule-form">
                <div class="form-group">
                    <label for="rule-name">规则名称:</label>
                    <input type="text" id="rule-name" placeholder="请输入规则名称" required>
                </div>
                <div class="form-group">
                    <label for="rule-type">规则类型:</label>
                    <select id="rule-type">
                        <option value="response">响应体修改</option>
                        <option value="request">请求修改</option>
                        <option value="response-headers">响应头修改</option>
                    </select>
                    <small>选择要修改的内容类型</small>
                </div>
                <div class="form-group">
                    <label for="rule-url-pattern">URL匹配模式:</label>
                    <input type="text" id="rule-url-pattern" placeholder="支持正则表达式，如: .*\.json$" required>
                    <small>支持正则表达式，留空则匹配所有请求</small>
                </div>
                <div class="form-group">
                    <label for="rule-method">请求方法:</label>
                    <select id="rule-method">
                        <option value="">所有方法</option>
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                        <option value="PUT">PUT</option>
                        <option value="DELETE">DELETE</option>
                    </select>
                </div>
                <div class="form-group" id="content-type-group">
                    <label for="rule-content-type">内容类型:</label>
                    <input type="text" id="rule-content-type" placeholder="如: application/json">
                    <small>留空则匹配所有内容类型（仅对响应体规则有效）</small>
                </div>
                <div class="form-group">
                    <label for="rule-action">操作类型:</label>
                    <select id="rule-action">
                        <option value="replace">替换响应体</option>
                        <option value="modify">修改响应体</option>
                        <option value="inject">注入内容</option>
                    </select>
                </div>

                <!-- 响应体修改相关字段 -->
                <div class="form-group" id="replace-content-group">
                    <label for="rule-replace-content">替换内容:</label>
                    <div class="replace-options">
                        <label>
                            <input type="radio" name="replace-type" value="text" checked> 文本内容
                        </label>
                        <label>
                            <input type="radio" name="replace-type" value="file"> 从文件替换
                        </label>
                    </div>
                    <textarea id="rule-replace-content" rows="8" placeholder="请输入要替换的完整响应体内容"></textarea>
                    <div id="file-replace-group" style="display: none;">
                        <label for="rule-file-path">文件路径:</label>
                        <div class="file-input-group">
                            <input type="text" id="rule-file-path" placeholder="选择要替换的文件路径" readonly>
                            <button type="button" id="browse-replace-file">浏览</button>
                        </div>
                        <small class="help-text">支持任何类型的文件，包括二进制文件（图片、视频、压缩包等）</small>
                    </div>
                </div>
                <div class="form-group" id="modify-rules-group" style="display: none;">
                    <label>修改规则:</label>
                    <div class="modify-rules-container">
                        <div class="modify-rule-item">
                            <input type="text" placeholder="查找内容(支持正则)" class="find-input">
                            <input type="text" placeholder="替换为" class="replace-input">
                            <button type="button" class="remove-modify-rule">删除</button>
                        </div>
                    </div>
                    <button type="button" id="add-modify-rule">添加修改规则</button>
                </div>
                <div class="form-group" id="inject-content-group" style="display: none;">
                    <label for="rule-inject-content">注入内容:</label>
                    <textarea id="rule-inject-content" rows="4" placeholder="要注入的内容"></textarea>
                    <div class="inject-position">
                        <label>注入位置:</label>
                        <select id="rule-inject-position">
                            <option value="start">开头</option>
                            <option value="end">结尾</option>
                            <option value="before">指定内容前</option>
                            <option value="after">指定内容后</option>
                        </select>
                        <input type="text" id="rule-inject-target" placeholder="目标内容(当选择指定位置时)" style="display: none;">
                    </div>
                </div>

                <!-- 请求修改相关字段 -->
                <div class="form-group" id="request-headers-group" style="display: none;">
                    <label>请求头修改:</label>
                    <div class="headers-container">
                        <div class="header-item">
                            <input type="text" placeholder="请求头名称" class="header-name-input">
                            <input type="text" placeholder="请求头值" class="header-value-input">
                            <button type="button" class="remove-header">删除</button>
                        </div>
                    </div>
                    <button type="button" id="add-request-header">添加请求头</button>
                </div>
                <div class="form-group" id="new-url-group" style="display: none;">
                    <label for="rule-new-url">重定向URL:</label>
                    <input type="text" id="rule-new-url" placeholder="请输入新的URL">
                    <small>请求将被重定向到此URL</small>
                </div>

                <!-- 响应头修改相关字段 -->
                <div class="form-group" id="response-headers-group" style="display: none;">
                    <label>响应头修改:</label>
                    <div class="headers-container">
                        <div class="header-item">
                            <input type="text" placeholder="响应头名称" class="header-name-input">
                            <input type="text" placeholder="响应头值" class="header-value-input">
                            <button type="button" class="remove-header">删除</button>
                        </div>
                    </div>
                    <button type="button" id="add-response-header">添加响应头</button>
                </div>
                <div class="form-group" id="remove-headers-group" style="display: none;">
                    <label for="rule-remove-headers">删除响应头:</label>
                    <input type="text" id="rule-remove-headers" placeholder="要删除的响应头名称，多个用逗号分隔">
                    <small>例如: Content-Security-Policy, X-Frame-Options</small>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="rule-enabled" checked>
                        启用此规则
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" id="save-rule-btn" class="save-btn">保存规则</button>
                    <button type="button" id="test-rule-btn" class="test-btn">测试规则</button>
                    <button type="button" id="cancel-rule-btn" class="cancel-btn">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>设置</h2>
            <div class="settings-container">
                <div class="setting-item">
                    <label for="cache-path">天学网缓存文件夹路径：</label>
                    <div class="path-input-wrapper">
                        <input type="text" id="cache-path" placeholder="请输入缓存文件夹路径" class="path-input">
                        <button id="browse-cache" class="browse-btn">浏览</button>
                    </div>
                </div>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="keep-cache-files">
                        不自动删除缓存文件（保留下载的临时文件）
                    </label>
                    <small style="color: #666; display: block; ">
                        勾选后，程序不会自动删除下载的ZIP文件和解压后的临时文件夹
                    </small>
                </div>
                <div class="setting-item">
                    <button id="save-settings" class="save-btn">保存设置</button>
                    <button id="reset-settings" class="reset-btn">重置为默认</button>
                </div>
                <div class="setting-item" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <button id="check-updates" class="browse-btn">检查更新</button>
                </div>
                <p id="error-message"></p>
            </div>
        </div>
    </div>

    <div id="update-modal" class="modal">
        <div class="modal-content update-modal-content">
            <div class="modal-header">
                <h2>发现新版本</h2>
                <span class="close" id="close-update">&times;</span>
            </div>
            <div class="update-modal-body">
                <p><strong>新版本号：</strong><span id="update-version"></span></p>
                <p><strong>发布日期：</strong><span id="update-date"></span></p>
                <div class="update-notes-container">
                    <strong>更新内容：</strong>
                    <div id="update-notes" class="update-notes"></div>
                </div>
                <div id="update-progress-container" class="update-progress-container">
                    <div class="update-progress-info">
                        <span id="update-progress-text">下载中: 0%</span>
                        <span id="update-progress-speed"></span>
                    </div>
                    <div class="update-progress-bar">
                        <div id="update-progress-bar-fill" class="update-progress-bar-fill"></div>
                    </div>
                </div>
                <div class="update-actions">
                    <button id="update-cancel" class="browse-btn update-btn-cancel">稍后更新</button>
                    <button id="update-confirm-btn" class="save-btn">立即更新</button>
                </div>
            </div>
        </div>
    </div>

    <div id="update-downloaded-modal" class="modal">
        <div class="modal-content update-downloaded-modal-content">
            <div class="modal-header">
                <h2>更新下载完成</h2>
            </div>
            <div class="update-modal-body">
                <p>更新已下载完成，是否现在安装并重启应用？</p>
                <div class="update-actions">
                    <button id="update-install-later" class="browse-btn update-btn-cancel">稍后安装</button>
                    <button id="update-install-now" class="save-btn">立即安装并重启</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./renderer.js"></script>
</body>

</html>