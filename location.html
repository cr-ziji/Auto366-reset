<!-- å®šä½çª—å£ - location.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Auto366 - ä½ç½®é€‰æ‹©</title>
  <link rel="icon" type="image/png" href="icon.png">
  <style>
    body {
      font-family: Arial, sans-serif; 
      margin: 0; 
      overflow: hidden; 
      background: transparent 
    }
    .marker {
      position: absolute;
      width: 30px;
      height: 30px;
      background-color: red;
      border-radius: 50%;
      cursor: move;
      user-select: none;
      z-index: 10;
    }
    .marker::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 10px;
      height: 10px;
      background: white;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
    #marker1 { top: 100px; left: 150px; }
    #marker2 { top: 200px; left: 350px; background-color: blue; }
    #confirmBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      z-index: 100;
    }
    .instructions-panel {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px;
      border-radius: 8px;
      z-index: 100;
      max-width: 300px;
      cursor: move;
      user-select: none;
    }
    .instructions-panel h3 {
      margin: 0 0 10px 0;
      color: #fff;
    }
    .instructions-panel p {
      margin: 5px 0;
      font-size: 14px;
    }
    .tip {
      color: #ffd700;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="instructions-panel">
    <h3>å®šä½è¯´æ˜</h3>
    <p>ğŸ”´ <strong>çº¢ç‚¹</strong>ï¼šæ‹–æ‹½åˆ°ç­”æ¡ˆè¾“å…¥æ¡†ä½ç½®</p>
    <p>ğŸ”µ <strong>è“ç‚¹</strong>ï¼šæ‹–æ‹½åˆ°"ä¸‹ä¸€é¡µ"æŒ‰é’®ä½ç½®</p>
    <p class="tip">æç¤ºï¼šç¡®ä¿ä¸¤ä¸ªç‚¹éƒ½å‡†ç¡®æ”¾ç½®åœ¨ç›®æ ‡ä½ç½®ï¼Œç„¶åç‚¹å‡»ç¡®å®š</p>
    <p class="tip">å¯æ‹–åŠ¨æ­¤é¢æ¿åˆ°å…¶ä»–ä½ç½®</p>
  </div>
  
  <div id="marker1" class="marker"></div>
  <div id="marker2" class="marker"></div>
  <button id="confirmBtn">ç¡®å®š</button>
  <script>
    const markers = {
      marker1: document.getElementById('marker1'),
      marker2: document.getElementById('marker2')
    };

    let locations1 = localStorage.getItem('pos-listening')
    if (locations1){
      locations1 = JSON.parse(locations1)
      markers.marker1.style.left = locations1.pos1.x - markers.marker1.offsetWidth / 2 + 'px'
      markers.marker1.style.top = locations1.pos1.y - markers.marker1.offsetHeight / 2 + 'px'
      markers.marker2.style.left = locations1.pos2.x - markers.marker2.offsetWidth / 2 + 'px'
      markers.marker2.style.top = locations1.pos2.y - markers.marker2.offsetHeight / 2 + 'px'
    }

    let activeMarker = null;
    let offset = { x: 0, y: 0 };

    // è¯´æ˜é¢æ¿æ‹–æ‹½åŠŸèƒ½
    const instructionsPanel = document.querySelector('.instructions-panel');
    let isDraggingPanel = false;
    let panelOffset = { x: 0, y: 0 };

    instructionsPanel.addEventListener('mousedown', (e) => {
      isDraggingPanel = true;
      panelOffset.x = instructionsPanel.offsetLeft - e.clientX;
      panelOffset.y = instructionsPanel.offsetTop - e.clientY;
    });

    // æ‹–æ‹½åŠŸèƒ½
    Object.values(markers).forEach(marker => {
      marker.addEventListener('mousedown', (e) => {
        activeMarker = marker;
        offset.x = marker.offsetLeft - e.clientX;
        offset.y = marker.offsetTop - e.clientY;
      });
    });

    document.addEventListener('mousemove', (e) => {
      // æ‹–æ‹½è¯´æ˜é¢æ¿
      if (isDraggingPanel) {
        instructionsPanel.style.left = `${e.clientX + panelOffset.x}px`;
        instructionsPanel.style.top = `${e.clientY + panelOffset.y}px`;
        return;
      }

      // æ‹–æ‹½æ ‡è®°ç‚¹
      if (!activeMarker) return;

      activeMarker.style.left = `${e.clientX + offset.x}px`;
      activeMarker.style.top = `${e.clientY + offset.y}px`;
    });

    document.addEventListener('mouseup', () => {
      activeMarker = null;
      isDraggingPanel = false;
    });

    // ç¡®è®¤æŒ‰é’®
    document.getElementById('confirmBtn').addEventListener('click', () => {
      const locations = {
        pos1: getPosition(markers.marker1),
        pos2: getPosition(markers.marker2)
      };

      window.electronAPI.setLocations(locations);
      window.close();
    });

    function getPosition(element) {
      const rect = element.getBoundingClientRect();
      return {
        x: Math.round(rect.left + rect.width / 2),
        y: Math.round(rect.top + rect.height / 2)
      };
    }
  </script>
</body>
</html>